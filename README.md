# integrity_checking v23.0

# calculate_nextseq_checksums.py
This script is used to display a message box on the sequencers, with the goal of ensuring data is not lost (eg. by setting off another run) should the data integrity check fail. 

This script is designed to be run on a NextSeq (not compatible with MiSeq). 

The script identifies when a run has started and opens a message box asking for users not to do anything on the sequencer until the integrity check has been performed.

Once the sequencing is complete (RTAcomplete.txt present) checksums are generated by this script for the local 'temp' runfolder and the 'remote' runfolder on the workstation.

As the data may still be in the process of being transferred for a few hours after the RTA complete file is created the checksums may not match at first. Therefore the checksums are repeated hourly until either they match, or the maximum number of attempts (see config file) are reached.

The final checksums are written to file within the runfolder on the workstation, which enables the demultiplexing script to assess the checksums and create a alert should the integrity test fail or demultiplex the run.

A pass or fail alert is also displayed on the sequencer to prevent further use of the sequencer before the integrity of the run is re-assessed.

## How to perform testing
When running with debug = true (config file) the script uses the workstation and sequencer_temp folders in the testing_data folder as mock runfolders.

These folders contain quite a few files but checksums are calculated quickly.

Debug mode also prints extra info to screen including some instruction, however to see this it must be run from the command line, not task scheduler.

On the sequencers Python lives in C://ProgramData/Miniconda2 - the ProgramData folder is hidden.

The script moves files specified in the config script (files_to_move) out of the dummy workstation runfolder which should result in a failed integrity test. 
The script waits 30 seconds before moving the missing file(s) back into the runfolder.
The test is then repeated (and should pass).


After testing:
Remember to set debug == False (config file).
