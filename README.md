# integrity_checking

# calculate_nextseq_checksums.py
This script is used to display a message box on the sequencers, with the goal of ensuring data is not lost (eg. by setting off another run) should the data integrity check fail. 

This script is run on the Nextseq. 

The script identifies when a run has started and opens a message box asking for users not to do anything on the sequencer until the integrity check has been performed.

Once the sequencing is complete (RTAcomplete.txt present) checksums are generated by this script for the local 'temp' runfolder and the 'remote' runfolder on the workstation.

As the data may still be in the process of being transferred for a few hours after the RTA complete file is created the checksums may not match at first. Therefore the checksums are repeated hourly until either they match, or the maximum number of attempts are reached.

The final checksums are written to file within the runfolder on the workstation, which enables the demultiplexing script to assess the checksums and create a alert should the integrity test fail or demultiplex the run.

A pass or fail alert is also displayed on the sequencer to prevent further use of the sequencer before the integrity of the run is re-assessed.

## How to perform testing
When running with debug = true the script uses the workstation and sequencer_temp folders in the testing_data folder as mock runfolders.

These folders contain quite a few files.

Debug mode also prints extra info to screen including some instruction, however to see this it must be run from the command line, not task scheduler.

On the sequencers Python lives in C://ProgramData/Miniconda (or something like this) - the ProgramData folder is hidden so you need to type it in.

The RunInfo.xml has been moved out of the dummy workstation runfolder which should result in a failed integrity test. 
The script waits 15 seconds and the debug messages prompt you to move the missing file(s) back into the runfolder.
The test should then pass.

After testing:
Move the RunInfo.xml file back out of the run folder for future testing.
Remember to turn debug back to False.
